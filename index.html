<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <title>canvas-select示例</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      /* .box {
      display: flex;
    } */

      .container {
        background-color: #ccc;
        width: 100%;
        max-width: 400px;
        height: 400px;
      }

      .right {
        margin-left: 20px;
      }

      #output {
        height: 450px;
        width: 400px;
      }
    </style>
  </head>

  <body>
    <div class="box">
      <div class="left">
        <canvas class="container"></canvas>
        <div>
          <button onclick="change(1)">create rectangle</button>
          <button onclick="change(2)">create polygon</button>
          <button onclick="change(3)">create point</button>
          <button onclick="change(4)">create polyline</button>
          <button onclick="change(5)">create circle</button>
          <button onclick="change(6)">create connectivity</button>
          <button onclick="change(0)">cancel creation</button>
          <br />
          <button onclick="zoom(true)">Zoom In</button>
          <button onclick="zoom(false)">zoom out</button>
          <button onclick="fitting()">Fitt</button>
          <button onclick="focusMode()">focus mode</button>
          <button onclick="setDragging(true)">start dragging</button>
          <button onclick="setDragging(false)">stop dragging</button>
        </div>
      </div>
      <!-- <div class="right">
      <div>output:</div>
      <textarea id="output" onchange="changeData()"></textarea>
    </div> -->
    </div>
    <script src="./lib/canvas-select.min.js"></script>
    <script>
      // alert(document.body.clientWidth)
      const output = document.getElementById("output");
      const instance = new CanvasSelect(
        ".container",
        "https://www.zhuhailiang.com/api/images/onepiece.png"
      );
      // instance.focusMode = true
      instance.ctrlRadius = navigator.userAgent.includes("Mobile") ? 6 : 3;
      window.c = instance;
      let option = [
        {
          label: "ABC",
          coor: [
            [184, 183],
            [275, 238],
          ],
          type: 1,
        },
        {
          label: "DEF",
          hideLabel: false,
          coor: [
            [258, 88],
            [359, 146],
          ],
          active: false,
          creating: false,
          dragging: false,
          uuid: "1998d731-64c5-4b20-a230-9945fb816208",
          type: 1,
        },
        {
          label: "GHI",
          coor: [
            [135, 291],
            [129, 319],
            [146, 346],
            [174, 365],
            [214, 362],
            [196, 337],
            [161, 288],
          ],
          type: 2,
        },
        {
          label: "点",
          coor: [345, 406],
          type: 3,
        },
        {
          label: "折线",
          coor: [
            [470, 155],
            [490, 230],
            [493, 298],
          ],
          type: 4,
        },
        {
          label: "圆形",
          coor: [369, 197],
          radius: 38,
          type: 5,
        },
      ];

      instance.on("load", (src) => {
        instance.setData(option);
      });
      instance.on("warn", (msg) => {});
      // 添加
      instance.on("add", (info) => {
        window.info = info;
      });
      // 删除
      instance.on("delete", (info) => {});
      // 选中
      instance.on("select", (info) => {});
      instance.on("updated", (result) => {
        const list = [...result];
        list.sort((a, b) => a.index - b.index);
        // console.log(list);
        // output.value = JSON.stringify(list, null, 2);
      });

      function change(num) {
        instance.createType = num;
      }
      function zoom(type) {
        instance.setScale(type);
      }
      function fitting() {
        instance.fitZoom();
      }
      function focusMode() {
        instance.setFocusMode(!instance.focusMode);
      }
      function changeData() {
        const data = JSON.parse(output.value);
        instance.setData(data);
      }
      function setDragging(value) {
        instance.setDragging = value;
      }
    </script>
    <!-- <script src="https://unpkg.com/stats.js@0.17.0/build/stats.min.js"> </script>
  <script>
    const stats = new Stats();
    // stats.showPanel(2); // 0: fps, 1: ms, 2: mb, 3+: custom
    document.body.appendChild(stats.dom);
    function animate() {
      stats.begin();
      // monitored code goes here
      stats.end();
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

  </script> -->
  </body>
</html>
