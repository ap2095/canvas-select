<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <title>canvas-select示例</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      #wrapper {
        position: relative;
        width: 700px;
        height: 800px;
        overflow: auto; /* Display scrollbars when content overflows */
      }

      /* .box {
      display: flex;
    } */

      /* .my-container {
        width: 100%;
        height: 100%;
      } */

      .canvas-container {
        width: 1440px; /* Set a width larger than the wrapper */
        height: 1440px; /* Set a height larger than the wrapper */
        position: relative;
        user-select: none;
      }

      .right {
        margin-left: 20px;
      }

      #output {
        height: 450px;
        width: 400px;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  </head>

  <body>
    <div>
      <div>
        <div id="wrapper">
          <canvas class="my-container"></canvas>
        </div>

        <div>
          <button onclick="change(1)">create rectangle</button>
          <button onclick="change(2)">create polygon</button>
          <button onclick="change(3)">create point</button>
          <button onclick="change(4)">create polyline</button>
          <button onclick="change(5)">create circle</button>
          <button onclick="change(6)">create connectivity</button>
          <button onclick="change(7)">extract Key</button>
          <button onclick="change(8)">extract Value</button>
          <button onclick="change(0)">cancel creation</button>
          <br />
          <button onclick="zoom(true)">Zoom In</button>
          <button onclick="zoom(false)">zoom out</button>
          <button onclick="fitting()">Fitt</button>
          <button onclick="focusMode()">focus mode</button>
          <button onclick="setDragging(true)">start dragging</button>
          <button onclick="setDragging(false)">stop dragging</button>
          <button onclick="reLoad()">Re-Load</button>
        </div>
      </div>
      <!-- <div class="right">
      <div>output:</div>
      <textarea id="output" onchange="changeData()"></textarea>
    </div> -->
    </div>
    <script src="./lib/canvas-select.min.js"></script>
    <script>
      // alert(document.body.clientWidth)
      const output = document.getElementById("output");
      const instance = new CanvasSelect(
        ".my-container",
        "./src/assets/images/cv.png"
      );
      // instance.focusMode = true
      instance.ctrlRadius = navigator.userAgent.includes("Mobile") ? 6 : 3;
      window.c = instance;
      let option = [
        {
          label: "",
          hideLabel: false,
          coor: [
            [52.800000000000104, 625.3500000000004],
            [148.50000000000003, 33],
          ],
          rectangleConnectivity: [1],
          lineCoorIndex: [5],
          strokeStyle: "#0f0",
          fillStyle: "rgba(0, 0, 255,0.1)",
          type: 1,
          active: false,
          creating: false,
          dragging: false,
          index: 0,
          uuid: "ff83a9e5-0145-4e5e-95b0-ad50404d2629",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
        {
          label: "",
          hideLabel: false,
          coor: [
            [46.2000000000001, 815.1000000000004],
            [257.4000000000001, 155.10000000000002],
          ],
          rectangleConnectivity: [0],
          lineCoorIndex: [5],
          strokeStyle: "#0f0",
          fillStyle: "rgba(0, 0, 255,0.1)",
          type: 1,
          active: false,
          creating: false,
          dragging: false,
          index: 1,
          uuid: "0e905327-6ae7-4eee-82e9-20d5d4db3022",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
        {
          label: "",
          hideLabel: false,
          coor: [
            [379.50000000000017, 574.2000000000004],
            [148.50000000000006, 41.25],
          ],
          rectangleConnectivity: [3],
          lineCoorIndex: [6],
          strokeStyle: "#0f0",
          fillStyle: "rgba(0, 0, 255,0.1)",
          type: 1,
          active: false,
          creating: false,
          dragging: false,
          index: 2,
          uuid: "17da5d67-2d11-43e2-8132-b8439d615794",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
        {
          label: "",
          hideLabel: false,
          coor: [
            [376.2000000000002, 717.7500000000003],
            [544.5, 87.45000000000005],
          ],
          rectangleConnectivity: [2, 4],
          lineCoorIndex: [6, 7],
          strokeStyle: "#0f0",
          fillStyle: "rgba(0, 0, 255,0.1)",
          type: 1,
          active: false,
          creating: false,
          dragging: false,
          index: 3,
          uuid: "7ab24220-edd4-497f-86dc-936e5de47d54",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
        {
          label: "",
          hideLabel: false,
          coor: [
            [379.50000000000017, 917.4000000000004],
            [100.65000000000003, 37.950000000000045],
          ],
          rectangleConnectivity: [3],
          lineCoorIndex: [7],
          strokeStyle: "#0f0",
          fillStyle: "rgba(0, 0, 255,0.1)",
          type: 1,
          active: false,
          creating: false,
          dragging: false,
          index: 4,
          uuid: "77a874c9-f02e-4bea-89fb-ff99eed75091",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
        {
          label: "",
          hideLabel: false,
          coor: [
            [202.30000000000013, 659.3500000000004],
            [47.2000000000001, 816.1000000000004],
          ],
          rectangleConnectivity: [0, 1],
          type: 6,
          active: false,
          creating: false,
          dragging: false,
          index: 5,
          uuid: "2727f4fa-a304-43ca-8dc6-14d301ca590b",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
        {
          label: "",
          hideLabel: false,
          coor: [
            [529.0000000000002, 616.4500000000004],
            [377.2000000000003, 718.7500000000003],
          ],
          rectangleConnectivity: [2, 3],
          type: 6,
          active: false,
          creating: false,
          dragging: false,
          index: 6,
          uuid: "b5ce87f0-83d9-441a-8a06-8762c5a40ebb",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
        {
          label: "",
          hideLabel: false,
          coor: [
            [377.2000000000003, 806.2000000000004],
            [481.1500000000002, 918.4000000000004],
          ],
          rectangleConnectivity: [3, 4],
          type: 6,
          active: false,
          creating: false,
          dragging: false,
          index: 7,
          uuid: "d4606edf-aca9-4c42-810d-f9f8a8c30cf8",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
        {
          label: "",
          hideLabel: false,
          coor: [
            [721.0500000000003, 1044.4500000000003],
            [122.10000000000002, 33],
          ],
          strokeStyle: "#0f0",
          fillStyle: "rgba(0, 0, 255,0.1)",
          type: 1,
          active: false,
          creating: false,
          dragging: false,
          index: 8,
          uuid: "7a5d2a40-a09e-4f0a-8dbb-e116e5d99b3c",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
        {
          label: "",
          hideLabel: false,
          coor: [
            [47.8500000000001, 996.6000000000005],
            [262.3500000000001, 145.19999999999993],
          ],
          strokeStyle: "#0f0",
          fillStyle: "rgba(0, 0, 255,0.1)",
          type: 1,
          active: false,
          creating: false,
          dragging: false,
          index: 9,
          uuid: "f1ff6978-ebe2-46a1-89c3-2cc454ed255a",
          data: {},
          canvasObj: {},
          previousCoor: [],
        },
      ];
      // let option = [
      //   {
      //     label: "ABC",
      //     hideLabel: false,
      //     coor: [
      //       [184, 183],
      //       [275, 238],
      //     ],
      //     rectangleConnectivity: [],
      //     lineCoorIndex: [],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "e14cf48d-4e60-46db-8ca4-8961d6ff0bba",
      //     index: 0,
      //     type: 1,
      //   },
      //   {
      //     label: "DEF",
      //     hideLabel: false,
      //     coor: [
      //       [258, 88],
      //       [359, 146],
      //     ],
      //     rectangleConnectivity: [],
      //     lineCoorIndex: [],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "1998d731-64c5-4b20-a230-9945fb816208",
      //     index: 1,
      //     type: 1,
      //   },
      //   {
      //     label: "点",
      //     hideLabel: false,
      //     coor: [345, 406],
      //     rectangleConnectivity: [],
      //     lineCoorIndex: [],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "8d19fa9a-8978-446c-83e0-0c7871058f60",
      //     index: 2,
      //     type: 3,
      //   },
      //   {
      //     label: "圆形",
      //     hideLabel: false,
      //     coor: [369, 197],
      //     rectangleConnectivity: [],
      //     lineCoorIndex: [],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "7aa5e595-bcc9-4edf-a4fc-3e91996a2fea",
      //     index: 3,
      //     radius: 38,
      //     type: 5,
      //   },
      //   {
      //     label: "",
      //     hideLabel: false,
      //     coor: [
      //       [379, 922],
      //       [468, 950],
      //     ],
      //     rectangleConnectivity: [],
      //     lineCoorIndex: [],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "f3f13f12-64d6-41d8-8b31-a8c2d9a1b094",
      //     index: 4,
      //     type: 1,
      //   },
      //   {
      //     label: "",
      //     hideLabel: false,
      //     coor: [
      //       [443, 974],
      //       [559, 994],
      //     ],
      //     rectangleConnectivity: [9],
      //     lineCoorIndex: [10],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "f9c69066-d1fa-4399-ac4c-884f6e8735bf",
      //     index: 5,
      //     type: 1,
      //   },
      //   {
      //     label: "",
      //     hideLabel: false,
      //     coor: [
      //       [440, 1023],
      //       [489, 1046],
      //     ],
      //     rectangleConnectivity: [8],
      //     lineCoorIndex: [11],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "44c7e4db-7562-4fe7-b495-c42d68274df4",
      //     index: 6,
      //     type: 1,
      //   },
      //   {
      //     label: "",
      //     hideLabel: false,
      //     coor: [
      //       [727, 992],
      //       [788, 1021],
      //     ],
      //     rectangleConnectivity: [],
      //     lineCoorIndex: [],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "5724ee08-0278-4684-959a-45a83ec49400",
      //     index: 7,
      //     type: 1,
      //   },
      //   {
      //     label: "",
      //     hideLabel: false,
      //     coor: [
      //       [609, 974],
      //       [672, 998],
      //     ],
      //     rectangleConnectivity: [9],
      //     lineCoorIndex: [10],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "a4c84b5b-38c3-4c08-826e-1d3eb53042b4",
      //     index: 9,
      //     type: 1,
      //   },
      //   {
      //     label: "",
      //     hideLabel: false,
      //     coor: [
      //       [559, 984],
      //       [609, 986],
      //     ],
      //     rectangleConnectivity: [5, 9],
      //     lineCoorIndex: [],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "39a136d4-4524-4c74-ab8a-d7e3e15b1ab9",
      //     index: 10,
      //     type: 6,
      //   },
      //   {
      //     label: "",
      //     hideLabel: false,
      //     coor: [
      //       [489, 1034.5],
      //       [530, 1032.5],
      //     ],
      //     rectangleConnectivity: [6, 8],
      //     lineCoorIndex: [],
      //     active: false,
      //     creating: false,
      //     dragging: false,
      //     uuid: "23a8ad0c-e178-47b1-9165-ae685e39ab0d",
      //     index: 11,
      //     type: 6,
      //   },
      //   {
      //     label: "",
      //     hideLabel: false,
      //     coor: [
      //       [530, 1019],
      //       [604, 1046],
      //     ],
      //     rectangleConnectivity: [6],
      //     lineCoorIndex: [11],
      //     active: true,
      //     creating: false,
      //     dragging: false,
      //     uuid: "e6b53279-f01b-4b66-8efc-c04d5e20d6c2",
      //     index: 8,
      //     type: 1,
      //   },
      // ];
      // let option = [];
      instance.on("load", (src) => {
        instance.loadData(option);
      });
      instance.on("warn", (msg) => {});
      // Get updated rectangle records
      instance.on("updatedRect", (info) => {
        console.log("updatedRect", info);
      });
      // 添加
      instance.on("add", (info) => {
        window.info = info;
        if (info.type === 7) {
          info["data"] = {
            extractType: "key",
          };
          instance.keyRectangleConnectivity =
            instance.parentRectangleConnectivity = info;
        }
        if (info.type === 8) {
          info["data"] = {
            extractType: "value",
          };
          instance.valueRectangleConnectivity =
            instance.childRectangleConnectivity = info;
        }
      });
      // 删除
      instance.on("delete", (info) => {});
      // 选中
      instance.on("select", (info) => {});
      instance.on("updated", (result) => {
        const list = [...result];
        list.sort((a, b) => a.index - b.index);
      });

      function reLoad() {
        instance.loadData(option);
      }
      function change(num) {
        instance.createType = num;
      }
      function zoom(type) {
        instance.setScale(type);
      }
      function fitting() {
        instance.fitZoom();
      }
      function focusMode() {
        instance.setFocusMode(!instance.focusMode);
      }
      function changeData() {
        const data = JSON.parse(output.value);
        instance.setData(data);
      }
      function setDragging(value) {
        instance.setDragging = value;
      }
    </script>
    <!-- <script src="https://unpkg.com/stats.js@0.17.0/build/stats.min.js"> </script>
  <script>
    const stats = new Stats();
    // stats.showPanel(2); // 0: fps, 1: ms, 2: mb, 3+: custom
    document.body.appendChild(stats.dom);
    function animate() {
      stats.begin();
      // monitored code goes here
      stats.end();
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

  </script> -->
  </body>
</html>
